language: go

before_script:
- go get github.com/mattn/goveralls
- go get github.com/wadey/gocovmerge

script:
- for module in $(find * -type d  | grep -v git-hooks); do \
  go test -v -covermode=count -coverprofile=$module.cov github.com/m-lab/epoxy/$module ; \
  done
# This assumes we never have a module named merged_test_coverage. A good
# assumption, but one we should note.
- $HOME/gopath/bin/gocovmerge *.cov > merged_test_coverage.cov
- $HOME/gopath/bin/goveralls -coverprofile=merge.cov -service=travis-ci
